(function(){"use strict";const r=[1,2,3,4,5,6,7,8,9],c=0;function P(){const n=[];for(let o=0;o<r.length;o++){const e=Array(r.length).fill(c);n.push(e)}return n}function p(n){return JSON.parse(JSON.stringify(n))}function m(n){return new Set(n).size===n.length}function S(n){return n.sort((o,e)=>.5-Math.random())}function q(n){let o=L(n);return D(o),C(o),K(o)||(o=Q(o)),en(o)}function Q(n){let o=p(n);const e=[];n:for(let t=0;t<r.length;t++)for(let s=0;s<r.length;s++){for(C(o);!d(o);)if(e.length>0){const l=e.pop();o=l.board,t=l.rowIndex,s=l.columnIndex,C(o)}else break n;const u=o.cellRows[t][s];E(u)||U(u,t,s,o,e)}return o}function U(n,o,e,t,s){const u=n.options.filter(i=>i!==c);if(u.length<2)throw new Error("Found a cell with less than 2 options, not sure what to do here...");const l=u[Math.floor(Math.random()*u.length)];H(l,o,e,t,s),n.onlyOptionValue=l,R(n,t)}function H(n,o,e,t,s){const u=p(t),l=u.cellRows[o][e];l.options[n]=c,l.optionsCount--,l.optionsCount===1&&u.singleOptionCellCoordinates.push({rowIndex:l.rowIndex,columnIndex:l.columnIndex}),y(n,l,u),s.push({board:u,rowIndex:o,columnIndex:e})}function D(n){X(n),b(n)}function d(n){return!n.hasCellWithNoOptions&&!n.hasCellThatIsOnlyOptionForMultipleValues}function K(n){return n.valuesCount===81}function C(n){for(;d(n)&&_(n);)z(n),nn(n)}function _(n){return n.singleOptionCellCoordinates.length>0||n.onlyOptionCellCoordinates.length>0}function z(n){for(;n.onlyOptionCellCoordinates.length>0&&d(n);){const o=n.onlyOptionCellCoordinates.shift(),e=n.cellRows[o.rowIndex][o.columnIndex];e.value||R(e,n)}}function R(n,o){const e=n.onlyOptionValue;k(n,e,o);const t=n.options.filter(s=>s!==e&&s!==c);I(n),J(n,t,o)}function J(n,o,e){o.forEach(t=>{y(t,n,e)})}function y(n,o,e){V(n,o,e),A(n,o,e),v(n,o,e)}function V(n,o,e){const t=e.rowsOptionsCounts[o.rowIndex];t[n]--,t[n]===1&&F(n,o.rowIndex,e)}function A(n,o,e){const t=e.columnsOptionsCounts[o.columnIndex];t[n]--,t[n]===1&&M(n,o.columnIndex,e)}function v(n,o,e){const t=e.squaresOptionsCounts[o.squareIndex];t[n]--,t[n]===1&&T(n,o.squareIndex,e)}function L(n){const o=()=>Array(r.length+1).fill(0),e=()=>Array(r.length).fill().map(o),t={cellRows:Array(r.length).fill().map(()=>Array()),valuesCount:0,rowsOptionsCounts:e(),columnsOptionsCounts:e(),squaresOptionsCounts:e(),singleOptionCellCoordinates:[],onlyOptionCellCoordinates:[],hasCellWithNoOptions:!1,hasCellThatIsOnlyOptionForMultipleValues:!1};return n.forEach((s,u)=>{s.forEach((l,i)=>{const a=an(u,i),f=j(l,u,i,a);l!==c&&(t.valuesCount++,I(f)),t.cellRows[u].push(f)})}),t}function j(n,o,e,t){return{value:n,rowIndex:o,columnIndex:e,squareIndex:t,optionsCount:0,options:Array(r.length+1).fill(0)}}function X(n){n.cellRows.forEach(o=>{o.forEach(e=>{E(e)||(Y(e,n),e.optionsCount===0&&(n.hasCellWithNoOptions=!0),e.optionsCount===1&&n.singleOptionCellCoordinates.push({rowIndex:e.rowIndex,columnIndex:e.columnIndex}))})})}function E(n){return n.value!==c}function Y(n,o){r.forEach(e=>{Z(e,n,o)&&$(e,n,o)})}function Z(n,o,e){const t=i=>i.value===n,s=()=>e.cellRows[o.rowIndex].some(t),u=()=>e.cellRows.some(i=>t(i[o.columnIndex])),l=()=>{const i=w(o.squareIndex);for(let a=i.minRow;a<=i.maxRow;a++)for(let f=i.minColumn;f<=i.maxColumn;f++)if(t(e.cellRows[a][f]))return!0;return!1};return!s()&&!u()&&!l()}function $(n,o,e){o.options[n]=n,o.optionsCount++,e.rowsOptionsCounts[o.rowIndex][n]++,e.columnsOptionsCounts[o.columnIndex][n]++,e.squaresOptionsCounts[o.squareIndex][n]++}function b(n){n.rowsOptionsCounts.forEach((o,e)=>{O(o,e,n,F)}),n.columnsOptionsCounts.forEach((o,e)=>{O(o,e,n,M)}),n.squaresOptionsCounts.forEach((o,e)=>{O(o,e,n,T)})}function O(n,o,e,t){n.forEach((s,u)=>{s===1&&t(u,o,e)})}function T(n,o,e){let t;const s=w(o);n:for(let u=s.minRow;u<=s.maxRow;u++)for(let l=s.minColumn;l<=s.maxColumn;l++){const i=e.cellRows[u][l];if(i.options&&i.options.includes(n)){t=i;break n}}x(n,t,e)}function M(n,o,e){let t;for(let s=0;s<r.length;s++){const u=e.cellRows[s][o];if(u.options&&u.options.includes(n)){t=u;break}}x(n,t,e)}function F(n,o,e){const t=e.cellRows[o].find(s=>s.options&&s.options.includes(n));x(n,t,e)}function x(n,o,e){o.optionsCount===1||(o.onlyOptionValue?o.onlyOptionValue!==n&&(e.hasCellThatIsOnlyOptionForMultipleValues=!0):(o.onlyOptionValue=n,e.onlyOptionCellCoordinates.push({rowIndex:o.rowIndex,columnIndex:o.columnIndex})))}function nn(n){for(;n.singleOptionCellCoordinates.length>0&&d(n);){const o=n.singleOptionCellCoordinates.shift(),e=n.cellRows[o.rowIndex][o.columnIndex];e.value||on(e,n)}}function on(n,o){const e=n.options.find(t=>t!==c);k(n,e,o),I(n)}function I(n){n.options=null,n.optionsCount=0}function k(n,o,e){n.value=o,e.valuesCount++,sn(n,o,e),tn(n,o,e)}function en(n){return n.cellRows.map(o=>o.map(e=>e.value))}function tn(n,o,e){un(n,e).forEach(s=>{s.options[o]!==c&&(s.options[o]=c,s.optionsCount--,s.optionsCount===1&&e.singleOptionCellCoordinates.push({rowIndex:s.rowIndex,columnIndex:s.columnIndex}),s.optionsCount===0&&(e.hasCellWithNoOptions=!0),s.rowIndex!==n.rowIndex&&V(o,s,e),s.columnIndex!==n.columnIndex&&A(o,s,e),s.squareIndex!==n.squareIndex&&v(o,s,e))})}function sn(n,o,e){e.rowsOptionsCounts[n.rowIndex][o]=0,e.columnsOptionsCounts[n.columnIndex][o]=0,e.squaresOptionsCounts[n.squareIndex][o]=0}function un(n,o){const e=ln(n,o),t=rn(n,o),s=cn(n,o).filter(u=>u.rowIndex!==n.rowIndex&&u.columnIndex!==n.columnIndex);return[...e,...t,...s]}function ln(n,o){return o.cellRows[n.rowIndex].filter(e=>h(e,n))}function rn(n,o){const e=[];return o.cellRows.forEach(t=>{const s=t[n.columnIndex];h(s,n)&&e.push(s)}),e}function cn(n,o){const e=[],t=w(n.squareIndex);for(let s=t.minRow;s<=t.maxRow;s++)for(let u=t.minColumn;u<=t.maxColumn;u++){const l=o.cellRows[s][u];h(l,n)&&e.push(l)}return e}function h(n,o){return n!==o&&n.options}function an(n,o){const e=[0,0,0,3,3,3,6,6,6],t=[0,0,0,1,1,1,2,2,2],s=e[n],u=t[o];return s+u}function w(n){const e=[0,0,0,3,3,3,6,6,6][n],s=[0,3,6,0,3,6,0,3,6][n],u=2;return{minRow:e,maxRow:e+u,minColumn:s,maxColumn:s+u}}function fn(n=null){return n||(n=()=>{}),Cn(n)}function dn(n){return N(q(n))}function N(n){return qn(n)}function pn(n){if(!wn(n))return N(n)?1:0;const o=2;let e=0;for(let t=0;t<r.length;t++)for(let s=0;s<r.length;s++)if(gn(n,t,s)){let u=0;const l=S(An(n,t,s));for(let i=0;i<l.length;i++){const a=p(n);if(a[t][s]=l[i],dn(a)){if(u++,u===o)return u;e=u}}}return e}function mn(){return q(P())}function Cn(n){return On(mn(),n)}function On(n,o){return S(hn()).forEach((t,s)=>{xn(t,n),o(s)}),n}function xn(n,o){const e=o[n.row][n.column];o[n.row][n.column]=c,In(o)||(o[n.row][n.column]=e)}function In(n){return pn(n)===1}function hn(){const n=[];return r.forEach((o,e)=>{r.forEach((t,s)=>{n.push({row:e,column:s})})}),n}function wn(n){return n.flat().some(o=>o===c)}function gn(n,o,e){return n[o][e]===c}function Sn(n){return n.flat().every(o=>r.includes(o))}function qn(n){return Sn(n)&&Rn(n)&&yn(n)&&Vn(n)}function Rn(n){return n.every(o=>m(o))}function yn(n){return r.every((o,e)=>{const t=B(n,e);return m(t)})}function Vn(n){const o=[0,4,7],e=o,t=o;return e.every(s=>t.every(u=>{const l=W(n,s,u);return m(l)}))}function An(n,o,e){const t=vn(n,o),s=B(n,e),u=W(n,o,e),l=[...t,...s,...u];return r.filter(a=>!l.includes(a))}function W(n,o,e){const t=[[0,1,2],[3,4,5],[6,7,8]],s=t.find(i=>i.includes(o)),u=t.find(i=>i.includes(e)),l=[];return s.forEach(i=>{u.forEach(a=>{l.push(n[i][a])})}),g(l)}function B(n,o){const e=[];for(let t=0;t<r.length;t++)e.push(n[t][o]);return g(e)}function vn(n,o){return g(n[o])}function g(n){return n.filter(o=>o!==c)}const G={positionProcessed:"positionProcessed",sudokuGenerated:"sudokuGenerated"};self.onmessage=n=>{n.data.generateSudoku&&En()};function En(){const n=fn(Tn);Mn(n)}function Tn(n){self.postMessage({messageType:G.positionProcessed,processedPositionsCount:n})}function Mn(n){self.postMessage({messageType:G.sudokuGenerated,generatedSudoku:n})}})();
