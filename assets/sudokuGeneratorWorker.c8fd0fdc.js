(function(){"use strict";const r=[1,2,3,4,5,6,7,8,9],c=0;function Q(){const n=[];for(let o=0;o<r.length;o++){const e=Array(r.length).fill(c);n.push(e)}return n}function p(n){return JSON.parse(JSON.stringify(n))}function C(n){return new Set(n).size===n.length}function V(n){return n.sort((o,e)=>.5-Math.random())}function y(n){let o=$(n);return K(o),m(o),_(o)||(o=U(o)),tn(o)}function U(n){let o=p(n);const e=[];n:for(let t=0;t<r.length;t++)for(let s=0;s<r.length;s++){for(m(o);!d(o);)if(e.length>0){const l=e.pop();o=l.board,t=l.rowIndex,s=l.columnIndex,m(o)}else break n;const u=o.cellRows[t][s];M(u)||H(u,t,s,o,e)}return o}function H(n,o,e,t,s){const u=n.options.filter(i=>i!==c);if(u.length<2)throw new Error("Found a cell with less than 2 options, not sure what to do here...");const l=u[Math.floor(Math.random()*u.length)];D(l,o,e,t,s),n.onlyOptionValue=l,q(n,t)}function D(n,o,e,t,s){const u=p(t),l=u.cellRows[o][e];l.options[n]=c,l.optionsCount--,l.optionsCount===1&&u.singleOptionCellCoordinates.push({rowIndex:l.rowIndex,columnIndex:l.columnIndex}),A(n,l,u),s.push({board:u,rowIndex:o,columnIndex:e})}function K(n){X(n),nn(n)}function d(n){return!n.hasCellWithNoOptions&&!n.hasCellThatIsOnlyOptionForMultipleValues}function _(n){return n.valuesCount===81}function m(n){for(;d(n)&&J(n);)z(n),on(n)}function J(n){return n.singleOptionCellCoordinates.length>0||n.onlyOptionCellCoordinates.length>0}function z(n){for(;n.onlyOptionCellCoordinates.length>0&&d(n);){const o=n.onlyOptionCellCoordinates.shift(),e=n.cellRows[o.rowIndex][o.columnIndex];e.value||q(e,n)}}function q(n,o){const e=n.onlyOptionValue;k(n,e,o);const t=n.options.filter(s=>s!==e&&s!==c);I(n),L(n,t,o)}function L(n,o,e){o.forEach(t=>{A(t,n,e)})}function A(n,o,e){v(n,o,e),E(n,o,e),G(n,o,e)}function v(n,o,e){const t=e.rowsOptionsCounts[o.rowIndex];t[n]--,t[n]===1&&N(n,o.rowIndex,e)}function E(n,o,e){const t=e.columnsOptionsCounts[o.columnIndex];t[n]--,t[n]===1&&F(n,o.columnIndex,e)}function G(n,o,e){const t=e.squaresOptionsCounts[o.squareIndex];t[n]--,t[n]===1&&T(n,o.squareIndex,e)}function $(n){const o=()=>Array(r.length+1).fill(0),e=()=>Array(r.length).fill().map(o),t={cellRows:Array(r.length).fill().map(()=>Array()),valuesCount:0,rowsOptionsCounts:e(),columnsOptionsCounts:e(),squaresOptionsCounts:e(),singleOptionCellCoordinates:[],onlyOptionCellCoordinates:[],hasCellWithNoOptions:!1,hasCellThatIsOnlyOptionForMultipleValues:!1};return n.forEach((s,u)=>{s.forEach((l,i)=>{const a=fn(u,i),f=j(l,u,i,a);l!==c&&(t.valuesCount++,I(f)),t.cellRows[u].push(f)})}),t}function j(n,o,e,t){return{value:n,rowIndex:o,columnIndex:e,squareIndex:t,optionsCount:0,options:Array(r.length+1).fill(0)}}function X(n){n.cellRows.forEach(o=>{o.forEach(e=>{M(e)||(Y(e,n),e.optionsCount===0&&(n.hasCellWithNoOptions=!0),e.optionsCount===1&&n.singleOptionCellCoordinates.push({rowIndex:e.rowIndex,columnIndex:e.columnIndex}))})})}function M(n){return n.value!==c}function Y(n,o){r.forEach(e=>{Z(e,n,o)&&b(e,n,o)})}function Z(n,o,e){const t=i=>i.value===n,s=()=>e.cellRows[o.rowIndex].some(t),u=()=>e.cellRows.some(i=>t(i[o.columnIndex])),l=()=>{const i=w(o.squareIndex);for(let a=i.minRow;a<=i.maxRow;a++)for(let f=i.minColumn;f<=i.maxColumn;f++)if(t(e.cellRows[a][f]))return!0;return!1};return!s()&&!u()&&!l()}function b(n,o,e){o.options[n]=n,o.optionsCount++,e.rowsOptionsCounts[o.rowIndex][n]++,e.columnsOptionsCounts[o.columnIndex][n]++,e.squaresOptionsCounts[o.squareIndex][n]++}function nn(n){n.rowsOptionsCounts.forEach((o,e)=>{O(o,e,n,N)}),n.columnsOptionsCounts.forEach((o,e)=>{O(o,e,n,F)}),n.squaresOptionsCounts.forEach((o,e)=>{O(o,e,n,T)})}function O(n,o,e,t){n.forEach((s,u)=>{s===1&&t(u,o,e)})}function T(n,o,e){let t;const s=w(o);n:for(let u=s.minRow;u<=s.maxRow;u++)for(let l=s.minColumn;l<=s.maxColumn;l++){const i=e.cellRows[u][l];if(i.options&&i.options.includes(n)){t=i;break n}}h(n,t,e)}function F(n,o,e){let t;for(let s=0;s<r.length;s++){const u=e.cellRows[s][o];if(u.options&&u.options.includes(n)){t=u;break}}h(n,t,e)}function N(n,o,e){const t=e.cellRows[o].find(s=>s.options&&s.options.includes(n));h(n,t,e)}function h(n,o,e){o.optionsCount===1||(o.onlyOptionValue?o.onlyOptionValue!==n&&(e.hasCellThatIsOnlyOptionForMultipleValues=!0):(o.onlyOptionValue=n,e.onlyOptionCellCoordinates.push({rowIndex:o.rowIndex,columnIndex:o.columnIndex})))}function on(n){for(;n.singleOptionCellCoordinates.length>0&&d(n);){const o=n.singleOptionCellCoordinates.shift(),e=n.cellRows[o.rowIndex][o.columnIndex];e.value||en(e,n)}}function en(n,o){const e=n.options.find(t=>t!==c);k(n,e,o),I(n)}function I(n){n.options=null,n.optionsCount=0}function k(n,o,e){n.value=o,e.valuesCount++,un(n,o,e),sn(n,o,e)}function tn(n){const o=[];return n.cellRows.forEach(e=>{const t=[];e.forEach(s=>{t.push(s.value)}),o.push(t)}),o}function sn(n,o,e){ln(n,e).forEach(s=>{s.options[o]!==c&&(s.options[o]=c,s.optionsCount--,s.optionsCount===1&&e.singleOptionCellCoordinates.push({rowIndex:s.rowIndex,columnIndex:s.columnIndex}),s.optionsCount===0&&(e.hasCellWithNoOptions=!0),s.rowIndex!==n.rowIndex&&v(o,s,e),s.columnIndex!==n.columnIndex&&E(o,s,e),s.squareIndex!==n.squareIndex&&G(o,s,e))})}function un(n,o,e){e.rowsOptionsCounts[n.rowIndex][o]=0,e.columnsOptionsCounts[n.columnIndex][o]=0,e.squaresOptionsCounts[n.squareIndex][o]=0}function ln(n,o){const e=rn(n,o),t=cn(n,o),s=an(n,o).filter(u=>u.rowIndex!==n.rowIndex&&u.columnIndex!==n.columnIndex);return[...e,...t,...s]}function rn(n,o){return o.cellRows[n.rowIndex].filter(e=>x(e,n))}function cn(n,o){const e=[];return o.cellRows.forEach(t=>{const s=t[n.columnIndex];x(s,n)&&e.push(s)}),e}function an(n,o){const e=[],t=w(n.squareIndex);for(let s=t.minRow;s<=t.maxRow;s++)for(let u=t.minColumn;u<=t.maxColumn;u++){const l=o.cellRows[s][u];x(l,n)&&e.push(l)}return e}function x(n,o){return n!==o&&n.options}function fn(n,o){const e=[0,0,0,3,3,3,6,6,6],t=[0,0,0,1,1,1,2,2,2],s=e[n],u=t[o];return s+u}function w(n){const o=[0,0,0,3,3,3,6,6,6],e=[2,2,2,5,5,5,8,8,8],t=[0,3,6,0,3,6,0,3,6],s=[2,5,8,2,5,8,2,5,8];return{minRow:o[n],maxRow:e[n],minColumn:t[n],maxColumn:s[n]}}function dn(n){return W(y(n))}function pn(n,o){const e=o[n.row][n.column];o[n.row][n.column]=c,mn(o)||(o[n.row][n.column]=e)}function Cn(){return V(hn())}function mn(n){return On(n)===1}function On(n){if(!In(n))return W(n)?1:0;const o=2;let e=0;for(let t=0;t<r.length;t++)for(let s=0;s<r.length;s++)if(xn(n,t,s)){let u=0;const l=V(qn(n,t,s));for(let i=0;i<l.length;i++){const a=p(n);if(a[t][s]=l[i],dn(a)){if(u++,u===o)return u;e=u}}}return e}function hn(){const n=[];return r.forEach((o,e)=>{r.forEach((t,s)=>{n.push({row:e,column:s})})}),n}function In(n){return n.flat().some(o=>o===c)}function xn(n,o,e){return n[o][e]===c}function wn(){return y(Q())}function W(n){return Sn(n)}function gn(n){return n.flat().every(o=>r.includes(o))}function Sn(n){return gn(n)&&Rn(n)&&Vn(n)&&yn(n)}function Rn(n){return n.every(o=>C(o))}function Vn(n){return r.every((o,e)=>{const t=B(n,e);return C(t)})}function yn(n){const o=[0,4,7],e=o,t=o;return e.every(s=>t.every(u=>{const l=g(n,s,u);return C(l)}))}function qn(n,o,e,t=!1){const s=En(n,o),u=B(n,e),l=g(n,o,e);if(!t&&An(e)&&vn(o)){const P=g(n,o,8).filter(R=>!s.includes(R)&&!u.includes(R)&&!l.includes(R));if(P.length>0)return P}const i=[...s,...u,...l];return r.filter(f=>!i.includes(f))}function An(n){return[3,4,5].includes(n)}function vn(n){return[1,4,7].includes(n)}function g(n,o,e){const t=[[0,1,2],[3,4,5],[6,7,8]],s=t.find(i=>i.includes(o)),u=t.find(i=>i.includes(e)),l=[];return s.forEach(i=>{u.forEach(a=>{l.push(n[i][a])})}),S(l)}function B(n,o){const e=[];for(let t=0;t<r.length;t++)e.push(n[t][o]);return S(e)}function En(n,o){return S(n[o])}function S(n){return n.filter(o=>o!==c)}self.onmessage=n=>{n.data.generateSudoku&&Gn()};function Gn(){const n=wn();Cn().forEach((e,t)=>{pn(e,n),Mn(t)}),Tn(n)}function Mn(n){self.postMessage({messageType:"positionProcessed",processedPositionsCount:n})}function Tn(n){self.postMessage({messageType:"sudokuGenerated",generatedSudoku:n})}})();
